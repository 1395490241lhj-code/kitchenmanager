<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>清理缓存与 Service Worker</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; padding:24px; line-height:1.6}
    code{background:#f2f4f8;padding:2px 6px;border-radius:4px}
  </style>
</head>
<body>
  <h1>清理缓存与 Service Worker</h1>
  <p>打开本页会自动卸载旧的 Service Worker 并清空缓存。</p>
  <pre id="log"></pre>
  <p><a href="./">返回应用主页</a></p>
<script>
(async function(){
  const out = document.getElementById('log');
  const log = (s) => out.innerHTML += s + '<br>';
  try{
    if ('serviceWorker' in navigator) {
      const regs = await navigator.serviceWorker.getRegistrations();
      for (const r of regs) { await r.unregister(); log('已卸载：' + (r.active && r.active.scriptURL)); }
    }
    if (window.caches && caches.keys) {
      const keys = await caches.keys();
      for (const k of keys) { await caches.delete(k); log('已清空缓存：' + k); }
    }
    log('完成。刷新或<a href="./">回到主页</a>');
  }catch(e){
    log('出错：' + e.message);
  }
})();
</script>
</body>
</html>