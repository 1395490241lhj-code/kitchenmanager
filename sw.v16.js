const CACHE_NAME='km-v16';const CORE=['./','./index.html','./styles.css','./app.js','./ingredients-list-patch.v15.css','./ingredients-list-patch.v15.js','./data/sichuan-recipes.json'];self.addEventListener('install',e=>{self.skipWaiting();e.waitUntil(caches.open(CACHE_NAME).then(c=>c.addAll(CORE)).catch(()=>{}))});self.addEventListener('activate',e=>{e.waitUntil((async()=>{const ns=await caches.keys();await Promise.all(ns.filter(n=>n!==CACHE_NAME).map(n=>caches.delete(n)));await self.clients.claim()})())});function isHTML(r){return r.mode==='navigate'||(r.headers.get('accept')||'').includes('text/html')}self.addEventListener('fetch',e=>{const r=e.request;const u=new URL(r.url);if(u.origin!==location.origin)return;if(isHTML(r)){e.respondWith((async()=>{try{const n=await fetch(r);const c=await caches.open(CACHE_NAME);c.put('./index.html',n.clone());return n}catch{const c=await caches.open(CACHE_NAME);const d=await c.match('./index.html');return d||new Response('<h1>Offline</h1>',{status:200,headers:{'Content-Type':'text/html'}})}})());return}e.respondWith((async()=>{const c=await caches.open(CACHE_NAME);const d=await c.match(r);const f=fetch(r).then(n=>{if(n&&n.ok)c.put(r,n.clone());return n}).catch(()=>d);return d||f})())});